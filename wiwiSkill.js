const redis = require('./redis.js');

// { type: 'message',
//   replyToken: '07b00f50e61d4ca3abada5b6a2b41778',
//   source: 
//    { userId: 'U451048461b01b3d2b99c117dca0e306d',
//      type: 'user',
//      profile: [Function] },
//   timestamp: 1494684341927,
//   message: 
//    { type: 'text',
//      id: '6080474222700',
//      text: 'wef',
//      content: [Function] },
//   reply: [Function] }
// { type: 'message',
//   replyToken: 'a2550a53d23c42f0b7d7523c989a26a5',
//   source: 
//    { groupId: 'C2ef79757c1f5a38bec83ac5da2f18ed5',
//      type: 'group',
//      profile: [Function] },
//   timestamp: 1494684385647,
//   message: 
//    { type: 'text',
//      id: '6080478474316',
//      text: 'test wiwi',
//      content: [Function] },
//   reply: [Function] }

const jokeList = [
  'ä½ çŸ¥é“ä»€éº¼èœœèœ‚æœ€é•·å£½å—Žï¼Ÿ ç­”æ¡ˆæ˜¯é«˜é½¡å³° ðŸ˜˜',
  'é˜¿ç½µè·Ÿå­«å¥³åŽ»æ¹–é‚Šï¼Œå­«å¥³æŽ‰åˆ°æ¹–è£¡ï¼Œæ¹–ä¸­å¥³ç¥žå•å¥¹åœ¨æ‰¾ä»€éº¼ï¼Œé˜¿ç½µ:[æˆ‘åœ¨æ‰¾é‡‘å­«]ï¼Œæ¹–ä¸­å¥³ç¥ž:[ä½ å¤ªè²ªå¿ƒäº†]',
  'å°å­©å­è·Œå€’ï¼ŒçŒœä¸€æˆèªžï¼Ÿ ç­”æ¡ˆï¼šé¦¬é¦¬è™Žè™Žï¼ˆåª½åª½æ’«æ’«ï¼‰',
  'æ­»æŽ‰çš„è…Žè‡Ÿï¼ŒçŒœä¸€æœ¬ä¸­åœ‹å°èªªï¼Ÿ ç­”æ¡ˆï¼šè¥¿éŠè¨˜ï¼ˆå°èªžï¼šæ­»è…°å­ï¼‰',
  'ä¸€é¡†å¿ƒå€¼å¤šå°‘éŒ¢ï¼Ÿ ç­”æ¡ˆï¼šä¸€å„„ï¼ˆä¸€å¿ƒä¸€æ„ï¼‰',
  'æ„›æ˜¯ä»€éº¼ï¼Ÿ ç­”æ¡ˆï¼šåŸºæ‘©äººï¼ˆæ„›æ–¯åŸºæ‘©äººï¼‰',
  'é¥…é ­å‡è£æ˜¯è‚‰åŒ…ï¼ŒçŒœä¸€äººåï¼Ÿ ç­”æ¡ˆï¼šå³å®—æ†²ï¼ˆç„¡ä¸­é™·ï¼‰',
  'èª°å®¶æ²’æœ‰é›»è©±ï¼Ÿ ç­”æ¡ˆï¼šå¤©è¡£ï¼Œå› ç‚ºå¤©è¡£ç„¡ç¸«ï¼ˆPHONEï¼‰',
  'å­”å­æœ‰3ä½å¾’å¼Ÿï¼šå­è²¢ã€å­è·¯å’Œå­æ¸¸ï¼Œå“ªä¸€ä½ä¸æ˜¯äººï¼Ÿ ç­”æ¡ˆï¼šå­è·¯ï¼Œå› ç‚ºæŒ‡é¹¿ç‚ºé¦¬ï¼ˆå­è·¯ç‚ºé¦¬ï¼‰',
  'å“ªç¨®å‹•ç‰©æœ€æ€•å†·ï¼Ÿ ç­”æ¡ˆï¼šé´¨å­ï¼ˆã€å‘±å‘±ã€žå°èªžï¼šå†·å†·ï¼‰',
  'è€é¼ å§“ä»€éº¼ï¼Ÿ ç­”æ¡ˆï¼šç±³ï¼ˆç±³è€é¼ ï¼‰',
  'ä¸€å£äº•ï¼Œæ—é‚Šæœ‰å…©æ¯èŒ¶çŒœä¸€ç¨®è·æ¥­ï¼Ÿ ç­”æ¡ˆï¼šè­¦å¯Ÿä¼¯ä¼¯',
  'é¯Šé­šä¸å°å¿ƒåžäº†ä¸€é¡†ç¶ è±†ï¼Œç‰ è®Šæˆäº†ä»€éº¼ï¼Ÿ ç­”æ¡ˆï¼šç¶ è±†æ²™ï¼ˆç¶ è±†é¯Šï¼‰',
  'å°‘äº†ä¸€æœ¬æ›¸ï¼ŒçŒœä¸€æˆèªžï¼Ÿ ç­”æ¡ˆï¼šç¼ºä¸€ä¸å¯ï¼ˆç¼ºä¸€Bookï¼‰',
  'ç¬¬11æœ¬æ›¸ï¼ŒçŒœä¸€æˆèªžï¼Ÿ ç­”æ¡ˆï¼šä¸å¯æ€è­°ï¼ˆBook11ï¼‰',
  'å¾ˆå¤šé›¢å©šçš„å¥³äººï¼ŒçŒœä¸€æˆèªžï¼Ÿ ç­”æ¡ˆï¼šå‰åŠŸç›¡æ£„ï¼ˆå‰å…¬ç›¡æ£„ï¼‰',
  'å¸Œçˆ¾é “ã€é¦™æ ¼é‡Œæ‹‰ã€å‡±æ‚…ï¼Œå“ªä¸€å®¶æœå‹™ç”Ÿæœ€æ²’ç¦®è²Œï¼Ÿ ç­”æ¡ˆï¼šé¦™æ ¼é‡Œæ‹‰ï¼ˆå°èªžï¼šèª°å«ä½ ä¾†ï¼‰',
  'å°æ˜Žçˆ¬æ¨“æ¢¯ï¼Œæ‰çˆ¬åˆ°2æ¨“ï¼Œç‚ºä»€éº¼è¦ºå¾—è…³å¾ˆé…¸ï¼Ÿ ç­”æ¡ˆï¼šå› ç‚ºä»–è¸©åˆ°æª¸æª¬',
  'å¤•é™½è¥¿ä¸‹ï¼Œæ–·è…¸äººåœ¨å“ªè£¡ï¼Ÿ ç­”æ¡ˆï¼šé†«é™¢',
  'äº”æœˆèŠ±å’Œç™¾åˆèŠ±å“ªä¸€å€‹æ²’æœ‰ç”Ÿå°å­©ï¼Ÿ ç­”æ¡ˆï¼šäº”æœˆèŠ±ã€‚äº”æœˆèŠ±ã€è¡›ç”Ÿç´™ã€žï¼ˆæœªç”Ÿå­ï¼‰',
  'ç‚ºä»€éº¼é˜¿é‡Œå·´å·´åªå¸¶36åæµ·ç›œéŽä¾†ï¼Ÿ ç­”æ¡ˆï¼šå› ç‚ºå°ç£å·²ç¶“æœ‰å¸‚æ°‘å¤§é“ï¼ˆ4åå¤§ç›œï¼‰äº†',
  'è€å¸«:ç‚ºå•¥è¦ä¾†ä¸Šå­¸ï¼Ÿ å­¸ç”Ÿ:ä¸è®“è€å¸«å¤±æ¥­ï¼',
  'çŒ©çŒ©è·ŸçŒ´å­å¾ˆæ€•ä¸€ç¨®ç·šï¼Œè«‹å•é‚£æ˜¯ä»€éº¼ç·šï¼Ÿ ç­”æ¡ˆ: å¹³è¡Œç·šï¼Œå› ç‚ºæ²’æœ‰ç›¸äº¤ï¼ˆæ²’æœ‰é¦™è•‰)',
  'å¤§è±¡çš„åª½åª½ç‚ºä»€éº¼æ˜¯çŒ©çŒ©ï¼Ÿ ç­”æ¡ˆ:å› ç‚ºè±¡ç”±çŒ©ç”Ÿé˜¿...ï¼ˆç›¸ç”±å¿ƒç”Ÿï¼‰',
  'æœ‰å€‹äººä½åœ¨é›¨å‚˜ä¸Šé¢ï¼ŒçŒœçŒœä»–æ˜¯èª°ï¼Ÿ ç­”æ¡ˆ:é»‘ç‹—å…„å•¦ï¼',
  'ç‚ºä»€éº¼ä¸Šå¸ä¸ç”¨ç§ŸAç‰‡? ç­”æ¡ˆ: æ˜¯å› ç‚ºäººåœ¨çœ‹å¤©åœ¨çœ‹',
  'äººé«”å“ªå€‹æ±è¥¿è²´çš„å¯è³£åˆ°å…†ï¼Ÿ ç­”æ¡ˆ: è†½...å¥½è†½éº¥è·‘(å…†).(å°èªž)',
  'æœ‰ä¸€æŠŠéš±å½¢çš„åŠï¼Œæ˜¯ä»€éº¼åŠï¼Ÿ ç­”æ¡ˆ:çœ‹ä¸è¦‹(åŠ)',
  'æŽå“ªå’ã€å”ä¸‰å¥˜ã€ç‰›é­”çŽ‹ï¼Œå“ªä¸€å€‹æ‚£æœ‰ä¸å­•ç—‡å‘¢ï¼Ÿ ç­”æ¡ˆ:å”ä¸‰å¥˜ã€å”ä¸‰å¥˜è¦åŽ»è¥¿æ–¹å–ç¶“(ç²¾)ã€‘',
  'èª°çš„å¤§ä¾¿æœ€æ¿ƒï¼Ÿ ç­”æ¡ˆ: å¸­ç¶­æ–¯ã€å±Žç‰¹æ¿ƒã€‘',
  'è«‹ä»–é£²æ–™åˆå¹«ä»–æ’ä¸Šå¸ç®¡...ä½†é‚„ä¸å–...é‚£éº¼å¤§ç‰Œçš„äººæ˜¯èª°ï¼Ÿ ç­”æ¡ˆ:ç¾Žåœ‹ç¸½çµ±å¸ƒå¸Œ(ä¸å¸)',
  'é¦¬.ç‹—.è±¬å„ä¸€éš».å“ªéš»è¼ƒè°æ˜Žï¼Ÿ ç­”æ¡ˆ:è±¬..å› ç‚ºè±¬(ç )ç®—~~é«˜æ‰‹',
  'è«‹å•è€è™Žå«ä»€éº¼åå­—å’§? ç­”æ¡ˆ:....ä¸¹ä¸¹~ å› ç‚ºï¼š è™Žè¦–çœˆçœˆ(è™Žæ˜¯ä¸¹ä¸¹)',
  'è«‹å•é€™å€‹ä¸–ç•Œä¸Šèª°çš„å¿«éžæœ€å¤šï¼Ÿ ç­”æ¡ˆ:çŽ‹è€å…ˆç”Ÿ....å› ç‚º....çŽ‹è€å…ˆç”Ÿæœ‰å¿«éž',
  'è¿ªå£«å°¼å¡é€šçš„è¾›å·´å§“ä»€éº¼? ç­”æ¡ˆ:..å§“çŽ‹..å› ç‚ºç…å­ çŽ‹è¾›å·´',
  'é€²æµ´å®¤æ´—æ¾¡æ™‚ï¼Œè¦å…ˆè„«è¡£æœé‚„æ˜¯è¤²å­ï¼Ÿ ç­”æ¡ˆ :å…ˆé—œé–€æ¯”è¼ƒå¥½',
];


const talkingJoke = (event) => {
  const joke = jokeList[Math.floor(Math.random() * jokeList.length)]
  event.reply(`ä¹–å–”ï½ž ðŸ¤— wiwiè¬›ç¬‘è©±çµ¦ä½ è½: ã€€${joke}`);
}

const rememberGroup = (event) => {
  if ((event.source.type === 'group')) {
    const groupId = event.source.groupId;
    redis.set('group', groupId);
    event.reply(`ç¾¤çµ„id:${groupId} å°‡èˆ‡ github é€£å‹•`);
  } else {
    event.reply('è«‹åœ¨ç¾¤çµ„å…§å«æˆ‘');
  }
}

const order = {
  'é€™æ˜¯ä½ å®¶': rememberGroup,
  'ç¬‘è©±|ç„¡èŠ|æ„›ç|æƒ³ç¡': talkingJoke,
};

const mainFunc = (event) => {
  if ((event.type === 'message') && (event.message.text.toLowerCase().indexOf('wiwi') > -1)) {
    const text = event.message.text;
    const commandList = Object.keys(order);
    const commandIndex = commandList.findIndex(command => new RegExp(command).test(text));
    (commandIndex > -1) && order[commandList[commandIndex]](event);
  }
};

module.exports = mainFunc;